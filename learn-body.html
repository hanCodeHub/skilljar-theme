<!-- Google Tag Manager (noscript) -->
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TFHWFX" height="0" width="0"
        style="display:none;visibility:hidden"></iframe>
</noscript>
<!-- End Google Tag Manager (noscript) -->

<!-- MAIN OFFERINGS BLOCK -->
<header id="offerings" hidden>
    <h1 class="section-header text-center">Choose a training offering that's right for you</h1>
    <!-- offering card elements supplied by Skilljar course series -->
</header>

<!-- LIVE AND PRIVATE TRAINING BLOCK -->
<section id="live-training" class="catalog-center-width section-body-dark" hidden>
    <div id="live-training-header" class="row catalog-center-width">
        <h1 class="section-header text-center">Reserve a seat in an upcoming live training event</h1>
        <span class="text-center btn-outline">
            <a href="http://nintex.skilljar.com/calendar" target="_blank">
                view calendar
            </a>
        </span>
    </div>
    <div id="live-training-body" class="row catalog-center-width text-center">

        <div id="events-table-section" class="text-center">
            <table id="events-table">
                <a>
                    <tr class="events-table-row">
                        <td>11-23-2019</td>
                        <td>09:00</td>
                        <td>Workflow O365 Optimization</td>
                        <td>10 seats</td>
                        <td>USD $249</td>
                    </tr>
                </a>
                <a>
                    <tr class="events-table-row">
                        <td>11-23-2019</td>
                        <td>15:00</td>
                        <td>Workflow O365 Optimization</td>
                        <td>5 seats</td>
                        <td>USD $249</td>
                    </tr>
                </a>
                <a>
                    <tr class="events-table-row">
                        <td>11-24-2019</td>
                        <td>09:00</td>
                        <td>Workflow O365 Testing</td>
                        <td>12 seats</td>
                        <td>USD $249</td>
                    </tr>
                </a>
                <a>
                    <tr class="events-table-row">
                        <td>11-24-2019</td>
                        <td>15:00</td>
                        <td>Workflow O365 Testing</td>
                        <td>9 seats</td>
                        <td>USD $249</td>
                    </tr>
                </a>
            </table>
        </div>

        <div id="private-training-section" class="text-center">
            <div class="card-container">
                <a href="" target="_blank">
                    <div class="card-message">
                        <p>Contact us for private training</p>
                    </div>
                    <img src="https://everpath-course-content.s3-accelerate.amazonaws.com/instructor%2Fhan_xu_nintex_com_9jmvc3%2Fpublic%2FCorporate-compliance_3.1573758844914.jpg"
                        class="card-image" alt="private training image">
                    <span class="card-message-overlay">
                        <h3>Request Form</h3>
                        <img src="https://everpath-course-content.s3-accelerate.amazonaws.com/instructor%2Fhan_xu_nintex_com_9jmvc3%2Fpublic%2Fform-icon.1573795608614.png"
                            class="card-icon" alt="form icon image">
                    </span>
                </a>
            </div>
        </div>

    </div>
</section>

<!-- GET STARTED BLOCK -->
<section id="get-started" class="catalog-center-width section-body-light" hidden>
    <!-- title -->
    <div id="get-started-header" class="row catalog-center-width">
        <h1 class="section-header text-center">Choose an option to get started with Nintex</h1>
    </div>
    <!-- tiles -->
    <div class="tile-row">
        <div class="card-container coursebox-container tile-column">
            <a>
                <!-- tile 1 -->
                <img src="https://everpath-course-content.s3-accelerate.amazonaws.com/instructor%2Fhan_xu_nintex_com_9jmvc3%2Fpublic%2FCapability1_Phone2.1574106590533.jpg"
                    alt="private training image">
                <div class="card-message">
                    <p>Intro To Process Mapping And Automation</p>
                </div>
            </a>
        </div>
        <!-- triangles forwards icon -->
        <div class="icon-container">
            <img src="https://everpath-course-content.s3-accelerate.amazonaws.com/instructor%2Fhan_xu_nintex_com_9jmvc3%2Fpublic%2Ftriangle-right-orange.1574102756310.png"
                alt="triangles pointing right">
        </div>

        <div class="card-container coursebox-container tile-column">
            <a>
                <!-- tile 2 -->
                <img src="https://everpath-course-content.s3-accelerate.amazonaws.com/instructor%2Fhan_xu_nintex_com_9jmvc3%2Fpublic%2Fplatform_1.1574106648181.jpg"
                    class="card-image" alt="private training image">
                <div class="card-message">
                    <p>Quickly Install And Configure Nintex</p>
                </div>
            </a>
        </div>
        <!-- triangles forwards icon -->
        <div class="icon-container">
            <img src="https://everpath-course-content.s3-accelerate.amazonaws.com/instructor%2Fhan_xu_nintex_com_9jmvc3%2Fpublic%2Ftriangle-right-orange.1574102756310.png"
                alt="triangles pointing right">
        </div>

        <div class="card-container coursebox-container tile-column">
            <a>
                <!-- tile 3 -->
                <img src="https://everpath-course-content.s3-accelerate.amazonaws.com/instructor%2Fhan_xu_nintex_com_9jmvc3%2Fpublic%2FCapability1_Ipad.1574106735695.jpg"
                    class="card-image" alt="private training image">
                <div class="card-message">
                    <p>Learn The Basics Of Your Nintex Product</p>
                </div>
            </a>
        </div>
    </div>

</section>

<!-- RESOURCES BLOCK -->
<section id="resources" class="catalog-center-width section-body-dark section-body-block" hidden>
    <div id="resources-header" class="row catalog-center-width">
        <h1 class="section-header text-center">Take advantage of additional resources</h1>
    </div>
    <div class="tile-row">
        <div class="image-link-container">
            <img src="https://everpath-course-content.s3-accelerate.amazonaws.com/instructor%2Fhan_xu_nintex_com_9jmvc3%2Fpublic%2Fplay-icon.1574190756692.png" 
            id="how-to-icon"
            class="image-link-icon"
            alt="how-to videos icon">
            <span class="text-center btn-outline">
                <a href="https://www.youtube.com/user/Nintex" target="_blank">
                    How-to Videos
                </a>
            </span>
        </div>
        <div class="image-link-container">
            <img src="https://everpath-course-content.s3-accelerate.amazonaws.com/instructor%2Fhan_xu_nintex_com_9jmvc3%2Fpublic%2Fcommunity-icon.1574190793235.png" 
            id="community-icon"
            class="image-link-icon"
            alt="community icon">
            <span class="text-center btn-outline">
                <a href="https://community.nintex.com/" target="_blank">
                    Community Forums
                </a>
            </span>
        </div>
        <div class="image-link-container">
            <img src="https://everpath-course-content.s3-accelerate.amazonaws.com/instructor%2Fhan_xu_nintex_com_9jmvc3%2Fpublic%2Fhelp-docs-icon.1574190820917.png" 
            id="helpdoc-icon"
            class="image-link-icon"
            alt="help documentation icon">
            <span class="text-center btn-outline">
                <a href="https://help.nintex.com/" target="_blank">
                    Help Documentation
                </a>
            </span>
        </div>
    </div>

</section>

<!-- ADDING NEW BLOCKS -->
<script>
    // CUSTOM BLOCKS - only add to homepage
    if (location.pathname === '/') {
        // Existing blocks
        const catalog = document.querySelector('#catalog-content');
        const courses = document.querySelector('#catalog-courses');
        const topRow = document.querySelector('.top-row');

        // New blocks
        const offerings = document.querySelector('#offerings');
        const liveTraining = document.querySelector('#live-training');
        const getStarted = document.querySelector('#get-started');
        const resources = document.querySelector('#resources');

        // make new blocks visible only on homepage
        for (section of [offerings, liveTraining, getStarted, resources])
            section.removeAttribute('hidden');

        // Insert new blocks
        catalog.insertBefore(offerings, courses);
        topRow.appendChild(liveTraining);
        topRow.appendChild(getStarted);
        topRow.appendChild(resources);

        // scroll to sections from links in banner
        const liveTrainingHeader = document.querySelector('#live-training-header');
        const linkLiveTraining = document.querySelector('#link-live-training');
        const linkGetStarted = document.querySelector('#link-get-started');
        const linkResources = document.querySelector('#link-resources');

        linkResources.addEventListener('click', () => resources.scrollIntoView(true));
        linkLiveTraining.addEventListener('click', () => liveTraining.scrollIntoView(true));
        linkGetStarted.addEventListener('click', () => getStarted.scrollIntoView(true));
    }

</script>

<!-- API CALLS -->
<script id="api-calls">

    // async function getData(url) {
    //     const response = await fetch(url, {
    //         method: 'GET',
    //         headers: {
    //             'Content-Type': 'application/json'
    //         }
    //     });
    //     return await response.json();
    // }

    // if (location.pathname === '/') {
    //     try {
    //         getData("http://127.0.0.1:5000/events/nintex.skilljar.com")
    //             .then(res => console.log(res.data))
    //             .catch(err => console.log(err));
    //     } catch (error) {
    //         console.error(error);
    //     }
    // }


</script>

<script>
    // Link to profile page
    const profileLink = document.querySelector('.profile-link');
    if (profileLink) {
        profileLink.addEventListener('click', toProfile);
    };

    function toProfile(e) {
        e.preventDefault();
        let reg = /https:\/\/\w*.nintex.com/
        let url = window.location.href
        let urlDomain = url.match(reg)[0]
        let profilePage = `${urlDomain}/accounts/profile/?next=/`
        window.location.assign(profilePage)
    };

    // Insert profile dropdown links
    $('#header-drop li:nth-child(1)').after('<li><a href="https://nintex-it.workflowcloud.com/forms/6e677242-5448-421d-a957-4811fccb0572" target="_blank">Feedback</a></li>');
    $('#header-drop li:nth-child(2)').after('<li><a href= "https://nintex-training.workflowcloud.com/forms/b013dd22-6173-4298-b48f-852ba1bd3a16" target="_blank">Request Content</a></li>');

    // Hide placeholder course
    let course = document.querySelector('a[data-course="wp01-intro-to-nintex"]')
    if (window.location.pathname === '/series/products') {
        course.setAttribute('style', 'display: none')
    }

    // Beamr Config
    const urlArr = window.location.href;
    const checkId = /\d{6}/;

    if (!checkId.test(urlArr)) {
        var beamer_config = {
            product_id: 'rEnQcjEg3705', //DO NOT CHANGE
            button_position: 'bottom-right',
            filter: 'nintexLearn'
        }
    }

</script>

<script type="text/javascript" src="https://app.getbeamer.com/js/beamer-embed.js" defer="defer"></script>

<script>
    // Display "Hello " + Student Name on the homepage
    const getStudent = () => {
        const resScript = document.scripts[9].innerHTML;
        const res = resScript.match("(?<=firstName\: \').*(?=')");
        helloMsg = res ? `Hello ${res}!` : "Hello!"
        $('#hero-header').html(helloMsg);
    }

    window.addEventListener('load', getStudent);

    // legal T&C link and currency additions on purchase page
    const controlPayment = () => {
        // select and hide purchase button onload
        let btnPurchase = document
            .querySelector("#payment-form > div:nth-child(3) > div > button")
        btnPurchase.style.display = 'none'

        // create and append new link to li, and new li to list
        let parentDiv = document.querySelector("#payment-form > div:nth-child(3) > div")
        let newLine = document.createElement('p')
        let legalLink = document.createElement('a')
        parentDiv.prepend(newLine)
        newLine.appendChild(legalLink)
        newLine.style.textAlign = 'center'

        // set link properties and content
        legalLink.innerHTML = 'I agree to Nintex Terms & Conditions'
        legalLink.href = 'https://www.nintex.com/legal/nintex-training-terms-and-conditions/'
        legalLink.target = '_blank'

        // create, prepend, and style checkbox
        let checkbox = document.createElement('input')
        checkbox.type = 'checkbox'
        newLine.prepend(checkbox)
        checkbox.style.width = '1.5rem'
        checkbox.style.height = '1.0rem'

        // listen for checks and display/hide purchase button
        checkbox.addEventListener('change', (e) => {
            if (e.target.checked) {
                btnPurchase.style.display = 'inline-block'
            } else {
                btnPurchase.style.display = 'none'
            }
        })
    }

    // Add USD to unitPrice
    const addCurrencyUnitPrice = () => {
        const unitPrice = document.querySelector(
            "#purchaseReview > div.white-bg.grey-bottom-border > div > div > div:nth-child(3) > div:nth-child(3) > div.item")
        unitPrice.prepend('USD ')
    }

    // Add USD to subPrice and totalPrice
    const addCurrencySubAndTotal = () => {
        const subPrice = document.querySelector("#subtotal")
        const totalPrice = document.querySelector("#total-price")
        subPrice.prepend('USD ')
        totalPrice.prepend('USD ')
    }

    // Adds currency and legal elements on first load
    document.addEventListener("DOMContentLoaded", () => {
        if (window.location.pathname.startsWith('/purchase/')) {
            controlPayment();
            addCurrencyUnitPrice();
            addCurrencySubAndTotal();
        }
    });

    // Adds currency again when page refreshes
    document.addEventListener('change', addCurrencySubAndTotal);

    // Hides the ribbons of each tile on certification page
    if (window.location.pathname.endsWith('/certifications')) {
        const ribbons = document.querySelectorAll('.sj-course-ribbon-wrapper')
        ribbons.forEach(e => e.style.display = 'none')
    }

    // reads the title label for the Next button into the button text
    const titleLabel = document.querySelector('.lesson-title-label')
    if (titleLabel) {
        document.querySelector('.next-lesson-link').innerHTML = titleLabel.innerHTML
    }

</script>